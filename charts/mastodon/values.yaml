nameOverride: ""
fullnameOverride: ""

image:
  # https://github.com/mastodon/mastodon/pkgs/container/mastodon
  # -- image repository to use
  repository: ghcr.io/mastodon/mastodon
  #
  # -- docker tag. use `latest` for the latest release or `edge` for the image built from the most recent commit
  tag: ""
  # -- image pullPolicy - use `Always` when using `latest` tag
  pullPolicy: IfNotPresent

mastodon:
  # -- create an initial administrator user; the password is autogenerated and will have to be reset
  createAdmin:
    # @ignored
    enabled: false
    # @ignored
    username: not_gargron
    # @ignored
    email: not@example.commit
    existingSecret: ""
    secretKeys:
      usernameKey: username
      passwordKey: password
      emailKey: email

  hooks:
    dbMigrate:
      enabled: true
    assetsPrecompile:
      enabled: true
    # Upload website assets to S3 before deploying using rclone.
    # Whenever there is an update to Mastodon, sometimes there are assets files
    # that are renamed. As the pods are getting redeployed, and old/new pods are
    # present simultaneously, there is a chance that old asset files are
    # requested from pods that don't have them anymore, or new asset files are
    # requested from old pods. Uploading asset files to S3 in this manner solves
    # this potential conflict.
    # Note that you will need to CDN/proxy to send all requests to /assets and
    # /packs to this bucket.
    s3Upload:
      enabled: false
      endpoint:
      bucket:
      acl: public-read
      secretRef:
        name:
        keys:
          accesKeyId: acces-key-id
          secretAccessKey: secret-access-key
      rclone:
        # Any additional environment variables to pass to rclone.
        env: {}

  cron:
    # -- run `tootctl media remove` every week
    removeMedia:
      # @ignored
      enabled: true
      # @ignored
      schedule: "0 0 * * 0"
  # -- available locales: https://github.com/mastodon/mastodon/blob/main/config/application.rb#L71
  locale: en
  local_domain: mastodon.local
  # -- Use of WEB_DOMAIN requires careful consideration: https://docs.joinmastodon.org/admin/config/#federation
  # You must redirect the path LOCAL_DOMAIN/.well-known/ to WEB_DOMAIN/.well-known/ as described
  # Example: mastodon.example.com
  web_domain: ""
  # -- If you have multiple domains pointed at your Mastodon server, this setting will allow Mastodon to recognize
  # itself when users are addressed using those other domains.
  alternate_domains: []
  # -- If set to true, the frontpage of your Mastodon server will always redirect to the first profile in the database and registrations will be disabled.
  singleUserMode: false
  # -- Enables "Secure Mode" for more details see: https://docs.joinmastodon.org/admin/config/#authorized_fetch
  authorizedFetch: false
  # -- Enables "Limited Federation Mode" for more detauls see: https://docs.joinmastodon.org/admin/config/#limited_federation_mode
  limitedFederationMode: false

  persistence:
    assets:
      # -- ReadWriteOnce is more widely supported than ReadWriteMany, but limits
      # scalability, since it requires the Rails and Sidekiq pods to run on the
      # same node.
      accessMode: ReadWriteOnce
      resources:
        requests:
          storage: 10Gi
      # -- name of existing persistent volume claim to use for assets
      existingClaim: ""

    system:
      accessMode: ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
      # -- name of existing persistent volume claim to use for system
      existingClaim: ""

  # -- optional extra volumes for the mastodon web pod
  extraVolumes: []

  # -- optional extra volume mounts for the mastodon web pod
  extraVolumeMounts: []

  s3:
    # -- enable using s3 instead of local persistence
    enabled: false
    access_key: ""
    access_secret: ""
    bucket: ""
    endpoint: ""
    hostname: ""
    region: ""
    permission: ""
    # -- If you have a caching proxy, enter its base URL here.
    alias_host: ""
    # When uploading data to S3, if the number of bytes to send exceedes
    # multipart_threshold then a multi part session is automatically started
    # and the data is sent up in chunks. Defaults to 16777216 (16MB).
    multipart_threshold: ""
    # -- you can also specify the name of an existing Secret
    # with keys AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
    existingSecret: ""
    secretKeys:
      s3AccessKeyID: AWS_ACCESS_KEY_ID
      s3AccessKey: AWS_SECRET_ACCESS_KEY
      s3Bucket: ""
      s3Endpoint: ""
      s3Hostname: ""
      s3Region: ""

  deepl:
    enabled: false
    plan: ""
    apiKeySecretRef:
      name: ""
      key: ""

  secrets:
    # -- must be set manually; autogenerated keys are rotated on each upgrade
    secret_key_base: ""
    otp_secret: ""
    vapid:
      private_key: ""
      public_key: ""
    activeRecordEncryption:
      primaryKey: ""
      deterministicKey: ""
      keyDerivationSalt: ""
    # -- the name of an existing Secret to use. keys must be:
    # VAPID_PRIVATE_KEY
    # VAPID_PUBLIC_KEY
    # SECRET_KEY_BASE
    # OTP_SECRET
    # ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY
    # ACTIVE_RECORD_ENCRYPTION_DETERMINISTIC_KEY
    # ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT
    existingSecret: ""

  sidekiq:
    # -- Pod security context for all Sidekiq Pods, overwrites .Values.podSecurityContext
    podSecurityContext: {}
    # -- (Sidekiq Container) Security Context for all Pods, overwrites .Values.securityContext
    securityContext: {}
    # -- Resources for all Sidekiq Deployments unless overwritten
    resources: {}
    # -- Affinity for all Sidekiq Deployments unless overwritten, overwrites .Values.affinity
    affinity: {}
    # limits:
    #   cpu: "1"
    #   memory: 768Mi
    # requests:
    #   cpu: 250m
    #   memory: 512Mi
    workers:
    - name: all-queues
      # -- Number of threads / parallel sidekiq jobs that are executed per Pod
      concurrency: 25
      # -- Number of Pod replicas deployed by the Deployment
      replicas: 1
      # -- Resources for this specific deployment to allow optimised scaling, overwrites .Values.mastodon.sidekiq.resources
      resources: {}
      # -- Affinity for this specific deployment, overwrites .Values.affinity and .Values.mastodon.sidekiq.affinity
      affinity: {}
      # -- Sidekiq queues for Mastodon that are handled by this worker. See https://docs.joinmastodon.org/admin/scaling/#concurrency
      # See https://github.com/mperham/sidekiq/wiki/Advanced-Options#queues for how to weight queues as argument
      queues:
        - default,8
        - push,6
        - ingress,4
        - mailers,2
        - pull
        - scheduler # Make sure the scheduler queue only exists once and with a worker that has 1 replica.
    #- name: push-pull
    #  concurrency: 50
    #  resources: {}
    #  replicas: 2
    #  queues:
    #    - push
    #    - pull
    #- name: mailers
    #  concurrency: 25
    #  replicas: 2
    #  queues:
    #    - mailers
    #- name: default
    #  concurrency: 25
    #  replicas: 2
    #  queues:
    #    - default

    # Open Telemetry configuration for sidekiq pods. Overrides global settings.
    otel:
      enabled: false
      exporterUri: ""
      namePrefix: ""
      nameSeparator: ""

  smtp:
    auth_method: plain
    ca_file: /etc/ssl/certs/ca-certificates.crt
    delivery_method: smtp
    domain:
    enable_starttls: 'auto'
    from_address: notifications@example.com
    return_path: ""
    openssl_verify_mode: peer
    port: 587
    reply_to: ""
    server: ""
    tls: false
    login: ""
    password: ""
    # -- Instead of defining server/login/password above, you can specify the name of an existing secret here. Login and
    # keys must be named `login`, `server`, `password` respectively.
    existingSecret: ""
  streaming:
    port: 4000
    # -- this should be set manually since os.cpus() returns the number of CPUs on
    # the node running the pod, which is unrelated to the resources allocated to
    # the pod by k8s
    workers: 1
    # -- The base url for streaming can be set if the streaming API is deployed to
    # a different domain/subdomain.
    base_url: null
    # -- Number of Streaming Pods running
    replicas: 1
    # -- Affinity for Streaming Pods, overwrites .Values.affinity
    affinity: {}
    # -- Pod Security Context for Streaming Pods, overwrites .Values.podSecurityContext
    podSecurityContext: {}
    # -- (Streaming Container) Security Context for Streaming Pods, overwrites .Values.securityContext
    securityContext: {}
    # -- (Streaming Container) Resources for Streaming Pods, overwrites .Values.resources
    resources: {}
    # limits:
    #   cpu: "500m"
    #   memory: 512Mi
    # requests:
    #   cpu: 250m
    #   memory: 128Mi
  web:
    port: 3000
    # -- Number of Web Pods running
    replicas: 1
    # -- Affinity for Web Pods, overwrites .Values.affinity
    affinity: {}
    # -- Pod Security Context for Web Pods, overwrites .Values.podSecurityContext
    podSecurityContext: {}
    # -- (Web Container) Security Context for Web Pods, overwrites .Values.securityContext
    securityContext: {}
    # -- (Web Container) Resources for Web Pods, overwrites .Values.resources
    resources: {}
    # limits:
    #   cpu: "1"
    #   memory: 1280Mi
    # requests:
    #   cpu: 250m
    #   memory: 768Mi
    # -- Puma-specific options. Below values are based on default behavior in
    # config/puma.rb when no custom values are provided.
    minThreads: "5"
    maxThreads: "5"
    workers: "2"
    persistentTimeout: "20"

    # -- Open Telemetry configuration for web pods. Overrides global settings.
    otel:
      enabled: false
      exporterUri:
      namePrefix: mastodon
      nameSeparator: "-"

  metrics:
    statsd:
      # -- Enable statsd publishing via STATSD_ADDR environment variable
      address: ""

  # -- Open Telemetry configuration for all deployments. Component-specific
  # configuration will override these values.
  otel:
    enabled: false
    exporterUri:
    namePrefix: mastodon
    nameSeparator: "-"

  # Sets the PREPARED_STATEMENTS environment variable: https://docs.joinmastodon.org/admin/config/#prepared_statements
  preparedStatements: true

ingress:
  enabled: true
  annotations:
    # For choosing an ingress ingressClassName is preferred over annotations
    # kubernetes.io/ingress.class: nginx
    #
    # To automatically request TLS certificates use one of the following
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt"
    #
    # ensure that NGINX's upload size matches Mastodon's
    #   for the K8s ingress controller:
    # nginx.ingress.kubernetes.io/proxy-body-size: 40m
    #   for the NGINX ingress controller:
    # nginx.org/client-max-body-size: 40m
  # -- you can specify the ingressClassName if it differs from the default
  ingressClassName:
  hosts:
    - host: mastodon.local
      paths:
        - path: '/'
  tls:
    - secretName: mastodon-tls
      hosts:
        - mastodon.local

# -- https://github.com/bitnami/charts/tree/main/bitnami/elasticsearch#parameters
elasticsearch:
  # `false` will disable full-text search
  #
  # if you enable ES after the initial install, you will need to manually run
  # RAILS_ENV=production bundle exec rake chewy:sync
  # (https://docs.joinmastodon.org/admin/optional/elasticsearch/)
  # @ignored
  enabled: true

externalDatabase:
  # -- enable to use an external database instead of the included bitnami postgresql subchart
  # if externalDatabase.enabled is true, postgresql.enabled must be false
  enabled: false
  # hostname of the database server
  hostname: ""
  # port to connect to the database over
  port: "5432"
  # name of the database on the server
  database: "mastodon"
  # -- user to connect to the database as
  user: "mastodon"
  # -- optional ssl mode, leave blank for no ssl, set to verify-full for ssl
  sslmode: ""
  # -- path of your optional ssl cert
  sslcert: ""
  # -- path of your optional ssl key
  sslkey: ""
  # -- path of your optional ssl root cert
  sslrootcert: ""
  # -- existingSecret for your postgresql credentials
  existingSecret: ""
  # secret keys in the existing secret to use
  secretKeys:
    password: "password"

# https://github.com/bitnami/charts/tree/main/bitnami/postgresql#parameters
postgresql:
  # -- disable if you want to use an existing db; in which case
  # -- if externalDatabase.enabled is true, postgresql.enabled must be false
  enabled: true
  auth:
    database: mastodon_production
    username: mastodon
    # you must set a password; the password generated by the postgresql chart will
    # be rotated on each upgrade:
    # https://github.com/bitnami/charts/tree/main/bitnami/postgresql#upgrade
    password: ""
    # Set the password for the "postgres" admin user
    # set this to the same value as above if you've previously installed
    # this chart and you're having problems getting mastodon to connect to the DB
    # postgresPassword: ""
    # you can also specify the name of an existing Secret
    # with a key of password set to the password you want
    existingSecret: ""

# https://github.com/bitnami/charts/tree/main/bitnami/redis#parameters
redis:
  # disable if you want to use an existing redis instance; in which case the
  # values below must match those of that external redis instance
  enabled: true
  hostname: ""
  port: 6379
  auth:
    # -- you must set a password; the password generated by the redis chart will be
    # rotated on each upgrade:
    password: ""
    # -- you can also specify the name of an existing Secret
    existingSecret: ""
    # -- key of password in existing secret
    existingSecretPasswordKey: "redis-password"

  # Configuration for a separate redis instance only for sidekiq processing.
  # If enabled, any values not specified will be copied from the base config.
  # If set to false, the main redis instance will be used, and all values will
  # be ignored.
  sidekiq:
    enabled: false
    hostname: ""
    port: 6379
    auth:
      password: ""
      # you can also specify the name of an existing Secret
      # with a key of redis-password set to the password you want
      existingSecret: ""

  # Configuration for a separate redis instance only for cache.
  # If enabled, any values not specified will be copied from the base config.
  # If set to false, the main redis instance will be used, and all values will
  # be ignored.
  cache:
    enabled: false
    hostname: ""
    port: 6379
    auth:
      password: ""
      # you can also specify the name of an existing Secret
      # with a key of redis-password set to the password you want
      existingSecret: ""

# @ignored
service:
  type: ClusterIP
  port: 80

externalAuth:
  oidc:
    # -- OpenID Connect support is proposed in PR #16221 and awaiting merge.
    enabled: false
    # display_name: "example-label"
    # issuer: https://login.example.space/auth/realms/example-space
    # discovery: true
    # scope: "openid,profile"
    # uid_field: uid
    # client_id: mastodon
    # client_secret: SECRETKEY
    # redirect_uri: https://example.com/auth/auth/openid_connect/callback
    # assume_email_is_verified: true
    # client_auth_method:
    # response_type:
    # response_mode:
    # display:
    # prompt:
    # send_nonce:
    # send_scope_to_token_endpoint:
    # idp_logout_redirect_uri:
    # http_scheme:
    # host:
    # port:
    # jwks_uri:
    # auth_endpoint:
    # token_endpoint:
    # user_info_endpoint:
    # end_session_endpoint:
  saml:
    enabled: false
    # acs_url: http://mastodon.example.com/auth/auth/saml/callback
    # issuer: mastodon
    # idp_sso_target_url: https://login.example.com/auth/realms/example/protocol/saml
    # idp_cert: '-----BEGIN CERTIFICATE-----[your_cert_content]-----END CERTIFICATE-----'
    # idp_cert_fingerprint:
    # name_identifier_format: urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified
    # cert:
    # private_key:
    # want_assertion_signed: true
    # want_assertion_encrypted: true
    # assume_email_is_verified: true
    # uid_attribute: "urn:oid:0.9.2342.19200300.100.1.1"
    # attributes_statements:
    #   uid: "urn:oid:0.9.2342.19200300.100.1.1"
    #   email: "urn:oid:1.3.6.1.4.1.5923.1.1.1.6"
    #   full_name: "urn:oid:2.16.840.1.113730.3.1.241"
    #   first_name: "urn:oid:2.5.4.42"
    #   last_name: "urn:oid:2.5.4.4"
    #   verified:
    #   verified_email:
  oauth_global:
    # -- Automatically redirect to OIDC, CAS or SAML, and don't use local account authentication when clicking on Sign-In
    omniauth_only: false
  cas:
    enabled: false
    # url: https://sso.myserver.com
    # host: sso.myserver.com
    # port: 443
    # ssl: true
    # validate_url:
    # callback_url:
    # logout_url:
    # login_url:
    # uid_field: 'user'
    # ca_path:
    # disable_ssl_verification: false
    # assume_email_is_verified: true
    # keys:
    #   uid: 'user'
    #   name: 'name'
    #   email: 'email'
    #   nickname: 'nickname'
    #   first_name: 'firstname'
    #   last_name: 'lastname'
    #   location: 'location'
    #   image: 'image'
    #   phone: 'phone'
  pam:
    enabled: false
    # email_domain: example.com
    # default_service: rpam
    # controlled_service: rpam
  ldap:
    enabled: false
    # host: myservice.namespace.svc
    # port: 636
    # method: simple_tls
    # tls_no_verify: true
    # base:
    # bind_dn:
    # password:
    # uid: cn
    # mail: mail
    # search_filter: "(|(%{uid}=%{email})(%{mail}=%{email}))"
    # uid_conversion:
    #   enabled: true
    #   search: "., -"
    #   replace: _

# -- https://github.com/mastodon/mastodon/blob/main/Dockerfile#L75
#
# if you manually change the UID/GID environment variables, ensure these values
# match:
podSecurityContext:
  runAsUser: 991
  runAsGroup: 991
  fsGroup: 991

# @ignored
securityContext: {}

serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Custom annotations to apply to all created deployment objects. These can be
# used to help mastodon interact with other services in the cluster.
deploymentAnnotations: {}

# -- Kubernetes manages pods for jobs and pods for deployments differently, so you might
# need to apply different annotations to the two different sets of pods. The annotations
# set with podAnnotations will be added to all deployment-managed pods.
podAnnotations: {}

# If set to true, an annotation with the current chart release number will be added to all mastodon pods. This will
# cause all pods to be recreated every `helm upgrade` regardless of whether their config or spec changes.
revisionPodAnnotation: true

# The annotations set with jobAnnotations will be added to all job pods.
jobAnnotations: {}

# -- Default resources for all Deployments and jobs unless overwritten
resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# @ignored
nodeSelector: {}

# @ignored
tolerations: []

# -- Affinity for all pods unless overwritten
affinity: {}

# -- timezone for all mastodon pods
timezone: UTC
